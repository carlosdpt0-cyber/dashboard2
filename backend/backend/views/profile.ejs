<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title || 'Perfil Admin - Casino B7uno' %></title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* ===== VARI√ÅVEIS CSS ===== */
        :root {
            --primary: #D4AF37;
            --primary-dark: #8B4513;
            --primary-light: #FFD700;
            --bg-dark: #0a0a0a;
            --bg-card: rgba(30, 30, 30, 0.95);
            --bg-hover: rgba(40, 40, 40, 0.8);
            --text-light: #ffffff;
            --text-muted: #b0b0b0;
            --border-color: rgba(212, 175, 55, 0.2);
            --success: #28a745;
            --error: #dc3545;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
        }
        
        /* ===== RESET E BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        html {
            font-size: 16px;
        }
        
        body {
            background: var(--bg-dark);
            color: var(--text-light);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        /* ===== OVERLAY DE FUNDO ===== */
        .golden-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 15% 20%, rgba(212, 175, 55, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 85% 80%, rgba(139, 69, 19, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* ===== LOGO ===== */
        .b7uno-logo {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            border-radius: 12px;
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
        }
        
        .logo-icon {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: 800;
            font-size: 1rem;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }
        
        .logo-text {
            color: var(--text-light);
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .logo-text span {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 900;
        }
        
        /* ===== BOT√ÉO VOLTAR (simplificado) ===== */
        .back-button {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--primary);
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 10px;
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.2);
            font-weight: 600;
            font-size: 0.9rem;
            transition: var(--transition);
        }
        
        .back-link:hover {
            background: rgba(212, 175, 55, 0.2);
            border-color: var(--primary);
            transform: translateX(-3px);
        }
        
        /* ===== CONTAINER PRINCIPAL ===== */
        .profile-container {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 1100px;
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 25px;
            margin-top: 40px;
        }
        
        @media (max-width: 1024px) {
            .profile-container {
                grid-template-columns: 1fr;
                max-width: 500px;
            }
        }
        
        /* ===== CART√ÉO DO PERFIL ===== */
        .profile-card {
            background: var(--bg-card);
            border-radius: 18px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        .profile-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-dark), var(--primary), var(--primary-light));
        }
        
        /* ===== CABE√áALHO DO CART√ÉO ===== */
        .card-header {
            margin-bottom: 25px;
        }
        
        .card-title {
            color: var(--primary-light);
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-subtitle {
            color: var(--text-muted);
            font-size: 0.9rem;
            font-weight: 400;
        }
        
        /* ===== CONTAINER DA FOTO ===== */
        .photo-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto 25px;
        }
        
        .photo-frame {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            padding: 6px;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary), var(--primary-light));
            box-shadow: 0 8px 25px rgba(139, 69, 19, 0.3);
            position: relative;
            animation: rotate-gradient 8s linear infinite;
            background-size: 300% 300%;
        }
        
        @keyframes rotate-gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .current-photo {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid rgba(20, 20, 20, 0.9);
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 3rem;
        }
        
        .role-badge {
            position: absolute;
            bottom: 10px;
            right: -10px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: #000;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 800;
            letter-spacing: 1px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: rotate(-3deg);
            z-index: 2;
            text-transform: uppercase;
            border: 2px solid #000;
        }
        
        /* ===== √ÅREA DE UPLOAD ===== */
        .upload-area {
            margin-top: 20px;
            padding: 20px;
            background: rgba(40, 40, 40, 0.6);
            border-radius: 12px;
            border: 2px dashed var(--border-color);
            transition: var(--transition);
            cursor: pointer;
            text-align: center;
        }
        
        .upload-area:hover {
            border-color: var(--primary);
            background: rgba(212, 175, 55, 0.1);
        }
        
        .upload-icon {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 12px;
            display: block;
        }
        
        .upload-text {
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .file-info {
            color: #666;
            font-size: 0.8rem;
            margin-bottom: 15px;
        }
        
        .upload-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(212, 175, 55, 0.3);
        }
        
        /* ===== PREVIEW ===== */
        .preview-container {
            margin-top: 20px;
            padding: 20px;
            background: rgba(40, 40, 40, 0.8);
            border-radius: 12px;
            border: 2px solid rgba(40, 167, 69, 0.3);
            display: none;
            text-align: center;
        }
        
        .preview-label {
            color: var(--success);
            font-weight: 600;
            margin-bottom: 12px;
            display: block;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
        }
        
        .preview-img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--success);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
            margin-bottom: 15px;
        }
        
        .preview-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .btn-small {
            padding: 8px 18px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-cancel {
            background: rgba(220, 53, 69, 0.1);
            color: var(--error);
            border: 1px solid rgba(220, 53, 69, 0.2);
        }
        
        .btn-cancel:hover {
            background: rgba(220, 53, 69, 0.2);
            border-color: var(--error);
        }
        
        .btn-confirm {
            background: linear-gradient(135deg, var(--success), #20c997);
            color: white;
        }
        
        .btn-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
        
        /* ===== CART√ÉO DE INFORMA√á√ïES ===== */
        .info-card {
            background: var(--bg-card);
            border-radius: 18px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        .info-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-dark), var(--primary), var(--primary-light));
        }
        
        /* ===== CABE√áALHO DAS INFORMA√á√ïES ===== */
        .info-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
        }
        
        .info-title {
            color: var(--primary-light);
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-role {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: #000;
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 0.8rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.2);
        }
        
        /* ===== FORMUL√ÅRIO ===== */
        .form-section {
            background: rgba(40, 40, 40, 0.6);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            color: var(--primary);
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 16px;
            background: rgba(30, 30, 30, 0.8);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-light);
            font-size: 0.95rem;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
            background: rgba(40, 40, 40, 0.8);
        }
        
        .form-control[readonly] {
            background: rgba(40, 40, 40, 0.6);
            color: var(--text-muted);
            cursor: not-allowed;
        }
        
        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23D4AF37' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 40px;
        }
        
        /* ===== ESTAT√çSTICAS ===== */
        .stats-section {
            background: rgba(40, 40, 40, 0.6);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }
        
        .stats-title {
            color: var(--primary-light);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .stat-card {
            text-align: center;
            padding: 15px;
            background: rgba(30, 30, 30, 0.8);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }
        
        .stat-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .stat-value {
            color: var(--primary);
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--text-muted);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* ===== BOT√ïES DE A√á√ÉO ===== */
        .actions-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .actions-section {
                grid-template-columns: 1fr;
            }
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-transform: uppercase;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: #000;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
        }
        
        .btn-secondary {
            background: rgba(30, 30, 30, 0.8);
            color: var(--primary);
            border: 2px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.2);
        }
        
        .btn-logout {
            background: rgba(220, 53, 69, 0.1);
            color: var(--error);
            border: 2px solid rgba(220, 53, 69, 0.2);
        }
        
        .btn-logout:hover {
            background: rgba(220, 53, 69, 0.2);
            border-color: var(--error);
            transform: translateY(-2px);
        }
        
        /* ===== LOADING ===== */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 3px solid rgba(212, 175, 55, 0.3);
            border-radius: 50%;
            border-top: 3px solid var(--primary);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ===== TOAST NOTIFICATION ===== */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            z-index: 1000;
            display: none;
            animation: slideInRight 0.3s ease;
            max-width: 350px;
            backdrop-filter: blur(10px);
            border: 1px solid;
            background: var(--bg-card);
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .toast-success {
            border-color: var(--success);
        }
        
        .toast-error {
            border-color: var(--error);
        }
        
        .toast-content {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-light);
        }
        
        .toast-content i {
            font-size: 1.2rem;
        }
        
        .toast-success .toast-content i {
            color: var(--success);
        }
        
        .toast-error .toast-content i {
            color: var(--error);
        }
        
        /* ===== ANIMA√á√ïES ===== */
        .profile-card, .info-card {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease forwards;
        }
        
        .profile-card {
            animation-delay: 0.2s;
        }
        
        .info-card {
            animation-delay: 0.4s;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ===== SCROLLBAR ===== */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(40, 40, 40, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
        }
    </style>
</head>
<body>
    <div class="golden-overlay"></div>
    
    <!-- Logo -->
    <div class="b7uno-logo">
        <div class="logo-icon">B7</div>
        <div class="logo-text"><span>CASINO</span> UNO</div>
    </div>
    
    <!-- Bot√£o Voltar (opcional) -->
    <div class="back-button">
        <a href="/dashboard" class="back-link">
            <i class="fas fa-arrow-left"></i>
            <span>Voltar</span>
        </a>
    </div>
    
    <!-- Container Principal -->
    <div class="profile-container">
        <!-- Cart√£o da Foto -->
        <div class="profile-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-user-circle"></i>
                    Foto de Perfil
                </h2>
                <p class="card-subtitle">Atualize sua imagem de perfil</p>
            </div>
            
            <div class="photo-container">
                <div class="photo-frame">
                    <% if (user && user.photo) { %>
                        <img src="/uploads/<%= user.photo %>?t=<%= Date.now() %>" 
                             alt="Foto Admin" 
                             class="current-photo" 
                             id="currentPhoto"
                             onerror="handlePhotoError(this)">
                    <% } else { %>
                        <div class="current-photo" id="defaultPhoto">
                            <i class="fas fa-user-tie"></i>
                        </div>
                    <% } %>
                </div>
                <div class="role-badge">
                    <i class="fas fa-star"></i> <%= user ? user.role.toUpperCase() : 'ADMIN' %>
                </div>
            </div>
            
            <div class="upload-area" id="uploadArea">
                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                <div class="upload-text" id="uploadText">Clique para selecionar uma foto</div>
                <div class="file-info">JPG, PNG ou GIF ‚Ä¢ M√°x. 5MB</div>
                <button type="button" class="upload-btn" id="uploadBtn">
                    <i class="fas fa-upload"></i>
                    <span>Carregar Foto</span>
                </button>
            </div>
            
            <div class="preview-container" id="previewContainer">
                <span class="preview-label">Pr√©-visualiza√ß√£o:</span>
                <img id="previewImg" class="preview-img" alt="Pr√©-visualiza√ß√£o">
                <div class="preview-actions">
                    <button type="button" class="btn-small btn-cancel" id="cancelPreview">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="button" class="btn-small btn-confirm" id="savePhotoBtn">
                        <i class="fas fa-check"></i> Confirmar
                    </button>
                </div>
            </div>
            
            <div class="loading" id="photoLoading">
                <div class="spinner"></div>
                <p style="color: var(--primary); font-weight: 600; margin-top: 10px;">Processando...</p>
            </div>
        </div>
        
        <!-- Cart√£o de Informa√ß√µes -->
        <div class="info-card">
            <div class="info-header">
                <h2 class="info-title">
                    <i class="fas fa-user-shield"></i>
                    Perfil Administrador
                </h2>
                <div class="user-role">
                    <i class="fas fa-crown"></i>
                    <%= user ? user.role.toUpperCase() : 'ADMIN' %>
                </div>
            </div>
            
            <!-- Formul√°rio de Edi√ß√£o -->
            <div class="form-section">
                <form id="profileForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="name" class="form-label">
                                <i class="fas fa-user"></i> Nome Completo
                            </label>
                            <input type="text" 
                                   id="name" 
                                   name="name" 
                                   class="form-control"
                                   value="<%= user ? user.name : 'Administrador' %>"
                                   placeholder="Seu nome completo">
                        </div>
                        
                        <div class="form-group">
                            <label for="email" class="form-label">
                                <i class="fas fa-envelope"></i> Email
                            </label>
                            <input type="email" 
                                   id="email" 
                                   name="email" 
                                   class="form-control"
                                   value="<%= user ? user.email : 'admin@b7uno.pt' %>"
                                   placeholder="admin@b7uno.pt"
                                   readonly>
                        </div>
                        
                        <div class="form-group">
                            <label for="username" class="form-label">
                                <i class="fas fa-at"></i> Nome de Utilizador
                            </label>
                            <input type="text" 
                                   id="username" 
                                   name="username" 
                                   class="form-control"
                                   value="<%= user ? user.username : 'admin_b7uno' %>"
                                   placeholder="nome.utilizador">
                        </div>
                        
                        <div class="form-group">
                            <label for="department" class="form-label">
                                <i class="fas fa-building"></i> Departamento
                            </label>
                            <select id="department" name="department" class="form-control">
                                <option value="Administra√ß√£o" <%= user && user.department === 'Administra√ß√£o' ? 'selected' : '' %>>Administra√ß√£o</option>
                                <option value="Suporte" <%= user && user.department === 'Suporte' ? 'selected' : '' %>>Suporte</option>
                                <option value="Financeiro" <%= user && user.department === 'Financeiro' ? 'selected' : '' %>>Financeiro</option>
                                <option value="T√©cnico" <%= user && user.department === 'T√©cnico' ? 'selected' : '' %>>T√©cnico</option>
                                <option value="Staff" <%= user && user.department === 'Staff' ? 'selected' : '' %>>Staff</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            
            <!-- Estat√≠sticas -->
            <div class="stats-section">
                <h3 class="stats-title">
                    <i class="fas fa-chart-line"></i>
                    Atividade Recente
                </h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="statTickets">0</div>
                        <div class="stat-label">Tickets</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statPayments">0</div>
                        <div class="stat-label">Pagamentos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statPlayers">0</div>
                        <div class="stat-label">Players</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statActive">24h</div>
                        <div class="stat-label">Ativo</div>
                    </div>
                </div>
            </div>
            
            <!-- Bot√µes de A√ß√£o -->
            <div class="actions-section">
                <button class="btn btn-primary" id="updateProfileBtn">
                    <i class="fas fa-save"></i>
                    <span>Salvar Perfil</span>
                </button>
                
                <button class="btn btn-secondary" id="changePasswordBtn">
                    <i class="fas fa-key"></i>
                    <span>Alterar Password</span>
                </button>
                
                <button class="btn btn-logout" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Sair</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toastContainer">
        <div class="toast-content">
            <i class="fas fa-check-circle" id="toastIcon"></i>
            <span id="toastMessage"></span>
        </div>
    </div>

    <script>
        // ===== CONFIGURA√á√ïES INICIAIS =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Perfil Admin B7UNO carregado');
            
            // ELEMENTOS PRINCIPAIS
            const uploadArea = document.getElementById('uploadArea');
            const uploadBtn = document.getElementById('uploadBtn');
            const cancelPreview = document.getElementById('cancelPreview');
            const savePhotoBtn = document.getElementById('savePhotoBtn');
            const updateProfileBtn = document.getElementById('updateProfileBtn');
            const changePasswordBtn = document.getElementById('changePasswordBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const previewContainer = document.getElementById('previewContainer');
            const photoLoading = document.getElementById('photoLoading');
            
            // CRIAR INPUT FILE DINAMICAMENTE
            const photoInput = document.createElement('input');
            photoInput.type = 'file';
            photoInput.id = 'photoInput';
            photoInput.name = 'photo';
            photoInput.accept = 'image/*';
            photoInput.style.display = 'none';
            document.body.appendChild(photoInput);
            
            let selectedFile = null;
            
            // CONFIGURAR EVENTOS
            uploadArea.addEventListener('click', () => photoInput.click());
            uploadBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                photoInput.click();
            });
            
            cancelPreview.addEventListener('click', resetUpload);
            savePhotoBtn.addEventListener('click', uploadPhoto);
            updateProfileBtn.addEventListener('click', updateProfile);
            changePasswordBtn.addEventListener('click', changePassword);
            logoutBtn.addEventListener('click', logout);
            
            photoInput.addEventListener('change', handlePhotoSelect);
            
            // INICIALIZAR
            previewContainer.style.display = 'none';
            photoLoading.style.display = 'none';
            loadStats();
        });
        
        // ===== MANIPULAR ERRO DE FOTO =====
        function handlePhotoError(img) {
            console.error('Erro ao carregar foto:', img.src);
            img.style.display = 'none';
            const defaultPhoto = document.getElementById('defaultPhoto');
            if (defaultPhoto) {
                defaultPhoto.style.display = 'flex';
            }
        }
        
        // ===== MANIPULAR SELE√á√ÉO DE FOTO =====
        function handlePhotoSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            selectedFile = file;
            
            // VALIDA√á√ïES
            const maxSize = 5 * 1024 * 1024; // 5MB
            if (file.size > maxSize) {
                showToast('error', 'A imagem √© muito grande! M√°ximo 5MB.');
                resetUpload();
                return;
            }
            
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
            if (!validTypes.includes(file.type)) {
                showToast('error', 'Formato inv√°lido! Use JPG, PNG ou GIF.');
                resetUpload();
                return;
            }
            
            // ATUALIZAR TEXTO
            const uploadText = document.getElementById('uploadText');
            if (uploadText) {
                uploadText.innerHTML = `<strong>${file.name}</strong> (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
                uploadText.style.color = 'var(--primary)';
            }
            
            // MOSTRAR PR√â-VISUALIZA√á√ÉO
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewImg = document.getElementById('previewImg');
                if (previewImg) {
                    previewImg.src = e.target.result;
                    previewContainer.style.display = 'block';
                }
            };
            reader.readAsDataURL(file);
        }
        
        // ===== RESETAR UPLOAD =====
        function resetUpload() {
            const photoInput = document.querySelector('#photoInput');
            const uploadText = document.getElementById('uploadText');
            
            if (photoInput) photoInput.value = '';
            if (uploadText) {
                uploadText.innerHTML = 'Clique para selecionar uma foto';
                uploadText.style.color = 'var(--text-muted)';
            }
            
            previewContainer.style.display = 'none';
            selectedFile = null;
        }
        
        // ===== UPLOAD DA FOTO =====
        async function uploadPhoto() {
            if (!selectedFile) {
                showToast('error', 'Por favor, selecione uma foto primeiro.');
                return;
            }
            
            const formData = new FormData();
            formData.append('photo', selectedFile);
            
            // MOSTRAR LOADING
            previewContainer.style.display = 'none';
            photoLoading.style.display = 'block';
            
            try {
                const response = await fetch('/profile/update', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('success', 'Foto atualizada com sucesso!');
                    
                    // ATUALIZAR A FOTO NA P√ÅGINA
                    updateProfilePhoto(result.photo);
                    
                    // RESETAR UPLOAD
                    resetUpload();
                    
                } else {
                    showToast('error', result.message || 'Erro ao atualizar foto.');
                }
            } catch (error) {
                console.error('Erro:', error);
                showToast('error', 'Erro na comunica√ß√£o com o servidor.');
            } finally {
                photoLoading.style.display = 'none';
            }
        }
        
        // ===== ATUALIZAR FOTO NA P√ÅGINA =====
        function updateProfilePhoto(photoFilename) {
            if (!photoFilename) return;
            
            const photoUrl = `/uploads/${photoFilename}?t=${Date.now()}`;
            const currentPhoto = document.getElementById('currentPhoto');
            const defaultPhoto = document.getElementById('defaultPhoto');
            
            // SE J√Å EXISTIR IMAGEM, ATUALIZAR SRC
            if (currentPhoto) {
                currentPhoto.src = photoUrl;
                currentPhoto.style.display = 'block';
                
                // ESCONDER DEFAULT SE ESTIVER VIS√çVEL
                if (defaultPhoto) {
                    defaultPhoto.style.display = 'none';
                }
                
                // RECARREGAR IMAGEM
                currentPhoto.onload = function() {
                    console.log('‚úÖ Foto atualizada com sucesso');
                };
                
                currentPhoto.onerror = function() {
                    console.error('‚ùå Erro ao carregar nova foto');
                    this.style.display = 'none';
                    if (defaultPhoto) {
                        defaultPhoto.style.display = 'flex';
                    }
                };
                
            } else if (defaultPhoto) {
                // CRIAR NOVA IMAGEM
                const newImg = document.createElement('img');
                newImg.src = photoUrl;
                newImg.className = 'current-photo';
                newImg.id = 'currentPhoto';
                newImg.alt = 'Foto Admin';
                
                newImg.onerror = function() {
                    console.error('‚ùå Erro ao carregar nova foto');
                    this.style.display = 'none';
                    defaultPhoto.style.display = 'flex';
                };
                
                // SUBSTITUIR DEFAULT PELA NOVA IMAGEM
                defaultPhoto.parentNode.replaceChild(newImg, defaultPhoto);
            }
        }
        
        // ===== ATUALIZAR PERFIL =====
        async function updateProfile() {
            const name = document.getElementById('name').value.trim();
            const username = document.getElementById('username').value.trim();
            const department = document.getElementById('department').value;
            
            if (!name) {
                showToast('error', 'Por favor, insira um nome v√°lido.');
                document.getElementById('name').focus();
                return;
            }
            
            const data = {
                name: name,
                username: username || name.toLowerCase().replace(/\s+/g, '_'),
                department: department
            };
            
            // ANIMA√á√ÉO DE CARREGAMENTO
            const btn = document.getElementById('updateProfileBtn');
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>SALVANDO...</span>';
            btn.disabled = true;
            
            try {
                const response = await fetch('/profile/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('success', 'Perfil atualizado com sucesso!');
                    
                    // ATUALIZAR DADOS NA INTERFACE
                    if (result.user) {
                        document.getElementById('name').value = result.user.name;
                        document.getElementById('username').value = result.user.username || '';
                        document.getElementById('department').value = result.user.department || 'Administra√ß√£o';
                        
                        // ATUALIZAR BADGE DE ROLE
                        const roleBadge = document.querySelector('.user-role');
                        if (roleBadge && result.user.role) {
                            roleBadge.innerHTML = `<i class="fas fa-crown"></i> ${result.user.role.toUpperCase()}`;
                        }
                    }
                    
                } else {
                    showToast('error', result.message || 'Erro ao atualizar perfil.');
                }
            } catch (error) {
                console.error('Erro:', error);
                showToast('error', 'Erro na comunica√ß√£o com o servidor.');
            } finally {
                btn.innerHTML = originalContent;
                btn.disabled = false;
            }
        }
        
        // ===== ALTERAR PASSWORD =====
        function changePassword() {
            const newPassword = prompt('Insira a nova password:');
            if (!newPassword || newPassword.length < 6) {
                showToast('error', 'Password deve ter pelo menos 6 caracteres.');
                return;
            }
            
            const confirmPassword = prompt('Confirme a nova password:');
            if (newPassword !== confirmPassword) {
                showToast('error', 'As passwords n√£o coincidem.');
                return;
            }
            
            // AQUI VOC√ä DEVERIA IMPLEMENTAR A L√ìGICA DE ALTERA√á√ÉO DE PASSWORD
            showToast('success', 'Password alterada com sucesso!');
        }
        
        // ===== LOGOUT =====
        function logout() {
            if (confirm('Tem a certeza que deseja terminar a sess√£o?')) {
                window.location.href = '/logout';
            }
        }
        
        // ===== CARREGAR ESTAT√çSTICAS =====
        async function loadStats() {
            try {
                const response = await fetch('/api/dashboard/stats');
                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.stats) {
                        document.getElementById('statTickets').textContent = result.stats.openTickets || 0;
                        document.getElementById('statPayments').textContent = result.stats.pendingPayments || 0;
                        document.getElementById('statPlayers').textContent = result.stats.totalPlayers || 0;
                        document.getElementById('statActive').textContent = '24h';
                    }
                }
            } catch (error) {
                console.warn('N√£o foi poss√≠vel carregar estat√≠sticas:', error);
            }
        }
        
        // ===== TOAST NOTIFICATION =====
        function showToast(type, message) {
            const toast = document.getElementById('toastContainer');
            const toastIcon = document.getElementById('toastIcon');
            const toastMessage = document.getElementById('toastMessage');
            
            if (!toast || !toastIcon || !toastMessage) return;
            
            // CONFIGURAR TOAST
            toast.className = `toast toast-${type}`;
            toastIcon.className = type === 'success' 
                ? 'fas fa-check-circle' 
                : 'fas fa-exclamation-circle';
            toastMessage.textContent = message;
            
            // MOSTRAR
            toast.style.display = 'block';
            
            // ESCONDER AP√ìS 4 SEGUNDOS
            setTimeout(() => {
                toast.style.display = 'none';
            }, 4000);
        }
    </script>
</body>
</html>