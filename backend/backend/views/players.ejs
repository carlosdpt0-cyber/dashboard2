<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title || 'B7Uno Casino | Jogadores' %></title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/players.css">
    <style>
        /* Estilos adicionais para garantir funcionamento */
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        /* VARI√ÅVEIS CSS - TEMA ESCURO */
        :root[data-theme="dark"] {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-tertiary: #888888;
            --accent-primary: #D4AF37;
            --accent-secondary: #FFD700;
            --accent-hover: #f5d042;
            --border-color: rgba(255, 255, 255, 0.1);
            --border-light: rgba(255, 255, 255, 0.05);
            --card-bg: rgba(30, 30, 30, 0.8);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --hover-bg: rgba(255, 255, 255, 0.05);
            --overlay-bg: rgba(0, 0, 0, 0.7);
            --success: #28a745;
            --success-light: rgba(40, 167, 69, 0.1);
            --warning: #ffc107;
            --warning-light: rgba(255, 193, 7, 0.1);
            --danger: #dc3545;
            --danger-light: rgba(220, 53, 69, 0.1);
            --info: #17a2b8;
            --info-light: rgba(23, 162, 184, 0.1);
            --photo-gradient: linear-gradient(135deg, #D4AF37, #FFD700);
        }

        /* VARI√ÅVEIS CSS - TEMA CLARO */
        :root[data-theme="light"] {
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f3f4;
            --text-primary: #1a1a1a;
            --text-secondary: #5f6368;
            --text-tertiary: #80868b;
            --accent-primary: #1a73e8;
            --accent-secondary: #4285f4;
            --accent-hover: #2b7de9;
            --border-color: rgba(0, 0, 0, 0.1);
            --border-light: rgba(0, 0, 0, 0.05);
            --card-bg: #ffffff;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --hover-bg: rgba(26, 115, 232, 0.04);
            --overlay-bg: rgba(255, 255, 255, 0.9);
            --success: #0d904f;
            --success-light: rgba(13, 144, 79, 0.1);
            --warning: #e37400;
            --warning-light: rgba(227, 116, 0, 0.1);
            --danger: #d93025;
            --danger-light: rgba(217, 48, 37, 0.1);
            --info: #1b72e8;
            --info-light: rgba(27, 114, 232, 0.1);
            --photo-gradient: linear-gradient(135deg, #1a73e8, #4285f4);
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 15px 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1100;
            animation: slideInRight 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            font-weight: 500;
            max-width: 350px;
        }
        
        .toast.success {
            border-left: 4px solid var(--success);
        }
        
        .toast.error {
            border-left: 4px solid var(--danger);
        }
        
        .toast.warning {
            border-left: 4px solid var(--warning);
        }
        
        .toast.info {
            border-left: 4px solid var(--info);
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* Modais */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--overlay-bg);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .modal.active {
            display: flex;
            opacity: 1;
        }
        
        .modal-content {
            background: var(--bg-secondary);
            border-radius: 12px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-tertiary);
            border-radius: 12px 12px 0 0;
        }
        
        .modal-header h3 {
            margin: 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: var(--hover-bg);
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            background: var(--bg-tertiary);
            border-radius: 0 0 12px 12px;
        }
        
        /* Formul√°rios nos modais */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--accent-primary);
        }
        
        /* Bot√µes */
        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: #000;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: var(--hover-bg);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        /* Bot√µes de a√ß√£o na tabela */
        .player-actions {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .btn-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .btn-icon:hover {
            background: var(--border-color);
            color: var(--text-primary);
            transform: translateY(-2px);
        }
        
        .btn-icon.view:hover { background: #2196F3; color: white; }
        .btn-icon.edit:hover { background: var(--success); color: white; }
        .btn-icon.email:hover { background: var(--warning); color: white; }
        .btn-icon.bonus:hover { background: #9C27B0; color: white; }
        .btn-icon.transaction:hover { background: #00BCD4; color: white; }
        .btn-icon.delete:hover { background: var(--danger); color: white; }
        
        /* Detalhes do jogador */
        .player-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .player-detail-card {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .player-detail-card h4 {
            margin-top: 0;
            margin-bottom: 15px;
            color: var(--accent-primary);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        
        .player-detail-card p {
            margin: 8px 0;
            color: var(--text-primary);
        }
        
        .player-detail-card strong {
            color: var(--accent-secondary);
        }
        
        /* Overlay para mobile */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--overlay-bg);
            z-index: 99;
        }
        
        .overlay.active {
            display: block;
        }
        
        /* User Dropdown */
        .user-dropdown {
            display: none;
            position: absolute;
            top: 70px;
            right: 20px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            width: 300px;
            z-index: 100;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .dropdown-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .user-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .dropdown-body {
            padding: 10px 0;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            color: var(--text-primary);
            text-decoration: none;
            transition: background 0.3s;
        }
        
        .dropdown-item:hover {
            background: var(--hover-bg);
        }
        
        .dropdown-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        /* NOTIFICA√á√ïES - NOVO ESTILO */
        .notifications-modal {
            max-width: 400px;
        }
        
        .notification-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .notification-item:hover {
            background: var(--hover-bg);
        }
        
        .notification-item.unread {
            background: var(--info-light);
        }
        
        .notification-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .notification-icon.info {
            background: var(--info-light);
            color: var(--info);
        }
        
        .notification-icon.warning {
            background: var(--warning-light);
            color: var(--warning);
        }
        
        .notification-icon.success {
            background: var(--success-light);
            color: var(--success);
        }
        
        .notification-icon.danger {
            background: var(--danger-light);
            color: var(--danger);
        }
        
        .notification-content {
            flex: 1;
            min-width: 0;
        }
        
        .notification-title {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        
        .notification-message {
            font-size: 12px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .notification-time {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }
        
        .notification-actions {
            display: flex;
            gap: 8px;
        }
        
        .notification-mark-read {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .notification-mark-read:hover {
            color: var(--success);
        }
        
        .empty-notifications {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }
        
        .empty-notifications i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .notification-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
            display: none;
        }
        
        .notification-count.show {
            display: block;
        }
        
        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s;
            user-select: none;
        }
        
        .theme-toggle:hover {
            background: var(--hover-bg);
        }
        
        .theme-toggle input {
            display: none;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 34px;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .theme-toggle[data-theme="dark"] .toggle-switch {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }
        
        .theme-toggle[data-theme="light"] .toggle-switch {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .toggle-switch::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            left: 3px;
            top: 3px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            overflow: hidden;
        }
        
        .theme-toggle[data-theme="dark"] .toggle-switch::before {
            content: 'üåô';
            color: #333;
            transform: translateX(0);
        }
        
        .theme-toggle[data-theme="light"] .toggle-switch::before {
            content: '‚òÄÔ∏è';
            color: #ff9800;
            transform: translateX(24px);
        }
        
        .theme-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            min-width: 80px;
            transition: color 0.3s;
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                max-height: 95vh;
            }
            
            .player-details-grid {
                grid-template-columns: 1fr;
            }
            
            .user-dropdown {
                width: calc(100% - 40px);
                right: 20px;
            }
            
            .notifications-modal {
                max-width: 90%;
            }
        }
    </style>
</head>
<body data-theme="dark">
    <!-- Main Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="logo">
                <h2>B7Uno Casino <span class="b7uno-badge">ADMIN</span></h2>
                <div class="user-mini-info">
                    <div class="user-mini-avatar" id="sidebarAvatar">
                        <% if (user && user.photo) { %>
                            <img src="/uploads/<%= user.photo %>?t=<%= Date.now() %>" 
                                 alt="<%= user.name %>"
                                 onerror="handleAvatarError(this, 'sidebarAvatar')">
                        <% } else { %>
                            <i class="fas fa-user-tie"></i>
                        <% } %>
                    </div>
                    <div class="user-mini-details">
                        <span id="sidebarStaffName"><%= user.name %></span>
                        <small id="sidebarStaffRole"><%= user.role %></small>
                    </div>
                </div>
            </div>
            
            <ul class="menu">
                <li><a href="/dashboard">
                    <i class="fas fa-home"></i><span> Dashboard</span>
                </a></li>
                <li><a href="/players" class="active">
                    <i class="fas fa-users"></i><span> Jogadores</span>
                    <% if (typeof stats !== 'undefined' && stats.pendingWithdrawals > 0) { %>
                        <span class="badge"><%= stats.pendingWithdrawals %></span>
                    <% } %>
                </a></li>
                <li><a href="/withdrawals">
                    <i class="fas fa-money-bill-wave"></i><span> Levantamentos</span>
                    <% if (typeof stats !== 'undefined' && stats.pendingWithdrawals > 0) { %>
                        <span class="badge"><%= stats.pendingWithdrawals %></span>
                    <% } %>
                </a></li>
                <li><a href="/payments">
                    <i class="fas fa-credit-card"></i><span> Pagamentos</span>
                </a></li>
                <li><a href="/support">
                    <i class="fas fa-headset"></i><span> Support</span>
                </a></li>
                <li><a href="/staff">
                    <i class="fas fa-user-tie"></i><span> Staff</span>
                </a></li>
                <li><a href="/email">
                    <i class="fas fa-envelope"></i><span> Email</span>
                </a></li>
                <li><a href="/logs">
                    <i class="fas fa-clipboard-list"></i><span> Logs</span>
                </a></li>
                <li><a href="/settings">
                    <i class="fas fa-cog"></i><span> Defini√ß√µes</span>
                </a></li>
                
                <!-- Theme Toggle -->
                <li>
                    <div class="theme-toggle" id="sidebarThemeToggle">
                        <input type="checkbox" id="sidebarThemeCheckbox">
                        <div class="toggle-switch" id="sidebarToggleSwitch"></div>
                        <span class="theme-label" id="sidebarThemeLabel">Modo Escuro</span>
                    </div>
                </li>
                
                <!-- Logout -->
                <li>
                    <a href="#" id="logoutBtnSidebar">
                        <i class="fas fa-sign-out-alt"></i><span> Logout</span>
                    </a>
                </li>
            </ul>
            
            <div class="sidebar-footer">
                <div class="system-status">
                    <div class="status-indicator"></div>
                    <span>Sistema Online</span>
                </div>
                <div class="server-time" id="serverTime">--:--:--</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Topbar -->
            <div class="topbar">
                <div class="topbar-left">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="breadcrumb" id="breadcrumb">
                        <%= breadcrumb || 'Jogadores' %>
                    </div>
                </div>
                
                <div class="topbar-right">
                    <!-- Theme Toggle -->
                    <div class="theme-toggle" id="topbarThemeToggle">
                        <input type="checkbox" id="topbarThemeCheckbox">
                        <div class="toggle-switch" id="topbarToggleSwitch"></div>
                        <span class="theme-label" id="topbarThemeLabel">Modo Escuro</span>
                    </div>
                    
                    <div class="notifications">
                        <button class="notification-btn" id="notificationBtn">
                            <i class="fas fa-bell"></i>
                            <span class="notification-count" id="notificationCount">0</span>
                        </button>
                    </div>
                    
                    <div class="user-profile" id="userProfile">
                        <div class="user-avatar" id="userAvatar">
                            <% if (user && user.photo) { %>
                                <img src="/uploads/<%= user.photo %>?t=<%= Date.now() %>" 
                                     alt="<%= user.name %>" 
                                     id="userAvatarImage"
                                     onerror="handleAvatarError(this, 'userAvatar')">
                            <% } else { %>
                                <span id="userInitials"><%= user.name.split(' ').map(n => n[0]).join('').toUpperCase() %></span>
                            <% } %>
                        </div>
                        <div class="user-details">
                            <div class="user-name" id="topbarStaffName"><%= user.name %></div>
                            <div class="user-role" id="topbarStaffRole"><%= user.role %></div>
                        </div>
                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                    </div>
                </div>
            </div>

            <!-- User Dropdown -->
            <div class="user-dropdown" id="userDropdown">
                <div class="dropdown-header">
                    <div class="user-info">
                        <div class="user-avatar" id="dropdownAvatar">
                            <% if (user && user.photo) { %>
                                <img src="/uploads/<%= user.photo %>?t=<%= Date.now() %>" 
                                     alt="<%= user.name %>" 
                                     id="dropdownAvatarImage"
                                     onerror="handleAvatarError(this, 'dropdownAvatar')">
                            <% } else { %>
                                <span id="dropdownInitials"><%= user.name.split(' ').map(n => n[0]).join('').toUpperCase() %></span>
                            <% } %>
                        </div>
                        <div>
                            <div class="user-name" id="dropdownUserName"><%= user.name %></div>
                            <div class="user-role"><%= user.role %></div>
                            <div class="user-email" style="font-size: 11px; color: var(--text-secondary);">
                                <%= user.email %>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="dropdown-body">
                    <a href="/profile" class="dropdown-item" id="myProfileLink">
                        <i class="fas fa-user"></i>
                        <span>Meu Perfil</span>
                    </a>
                    <a href="/settings" class="dropdown-item">
                        <i class="fas fa-cog"></i>
                        <span>Defini√ß√µes</span>
                    </a>
                    <a href="/logs" class="dropdown-item">
                        <i class="fas fa-history"></i>
                        <span>Hist√≥rico</span>
                    </a>
                </div>
                <div class="dropdown-footer">
                    <button class="btn btn-secondary" id="logoutBtnDropdown">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>

            <!-- Modal de Notifica√ß√µes -->
            <div class="modal" id="notificationsModal">
                <div class="modal-content notifications-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-bell"></i> Notifica√ß√µes</h3>
                        <button class="modal-close" id="modalClose">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="notifications-list" id="notificationsList">
                            <div class="empty-notifications">
                                <i class="fas fa-bell-slash"></i>
                                <p>Carregando notifica√ß√µes...</p>
                            </div>
                        </div>
                        <div class="modal-actions" style="padding: 16px 24px; border-top: 1px solid var(--border-color);">
                            <button class="btn btn-secondary" id="markAllAsReadBtn" style="width: 100%; margin-bottom: 8px;">
                                <i class="fas fa-check-double"></i> Marcar todas como lidas
                            </button>
                            <button class="btn btn-secondary" id="clearAllNotificationsBtn" style="width: 100%;">
                                <i class="fas fa-trash"></i> Limpar todas
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Header -->
                <div style="margin-bottom: 30px;">
                    <h1 style="font-size: 28px; margin-bottom: 10px;">
                        <i class="fas fa-users"></i> Gest√£o de Jogadores
                    </h1>
                    <p style="color: var(--text-secondary); font-size: 16px;">
                        Bem-vindo √† gest√£o de jogadores do B7Uno Casino, <%= user.name %>!
                        <% if (user.lastLogin) { %>
                            <br><small style="font-size: 12px;">√öltimo login: <%= new Date(user.lastLogin).toLocaleString('pt-PT') %></small>
                        <% } %>
                    </p>
                </div>
                
                <!-- Stats Cards -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-value"><%= typeof stats !== 'undefined' ? stats.total || 0 : 0 %></div>
                        <div class="stat-label">Total Jogadores</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value"><%= typeof stats !== 'undefined' ? stats.online || 0 : 0 %></div>
                        <div class="stat-label">Online Agora</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value"><%= typeof stats !== 'undefined' ? stats.active || 0 : 0 %></div>
                        <div class="stat-label">Ativos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value"><%= typeof stats !== 'undefined' ? stats.withNewsletter || 0 : 0 %></div>
                        <div class="stat-label">Com Newsletter</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value"><%= typeof stats !== 'undefined' ? stats.newToday || 0 : 0 %></div>
                        <div class="stat-label">Novos Hoje</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">
                            ‚Ç¨<%= typeof stats !== 'undefined' && stats.totalBalance ? stats.totalBalance.toFixed(2) : '0.00' %>
                        </div>
                        <div class="stat-label">Saldo Total</div>
                    </div>
                </div>
                
                <!-- Filtros -->
                <div class="filters-bar">
                    <form method="GET" action="/players" style="display: flex; gap: 10px; flex: 1; flex-wrap: wrap;">
                        <input type="text" name="search" placeholder="Pesquisar jogador..." class="form-control" 
                               value="<%= search || '' %>" style="flex: 1; min-width: 200px;">
                        <select name="status" class="form-control">
                            <option value="">Todos status</option>
                            <option value="online" <%= status === 'online' ? 'selected' : '' %>>Online</option>
                            <option value="active" <%= status === 'active' ? 'selected' : '' %>>Ativo</option>
                            <option value="inactive" <%= status === 'inactive' ? 'selected' : '' %>>Inativo</option>
                            <option value="banned" <%= status === 'banned' ? 'selected' : '' %>>Banido</option>
                        </select>
                        <select name="sort" class="form-control">
                            <option value="newest" <%= sort === 'newest' ? 'selected' : '' %>>Mais recentes</option>
                            <option value="oldest" <%= sort === 'oldest' ? 'selected' : '' %>>Mais antigos</option>
                            <option value="balance_high" <%= sort === 'balance_high' ? 'selected' : '' %>>Maior saldo</option>
                            <option value="balance_low" <%= sort === 'balance_low' ? 'selected' : '' %>>Menor saldo</option>
                        </select>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i> Filtrar
                        </button>
                        <button type="button" class="btn" onclick="window.location.href='/players'">
                            <i class="fas fa-redo"></i> Limpar
                        </button>
                    </form>
                    
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="exportPlayersToCSV()">
                            <i class="fas fa-download"></i> Exportar CSV
                        </button>
                        <button class="btn btn-success" onclick="showAddPlayerModal()">
                            <i class="fas fa-plus"></i> Novo Jogador
                        </button>
                        <button class="btn btn-info" onclick="showBulkActionsModal()">
                            <i class="fas fa-tasks"></i> A√ß√µes em Massa
                        </button>
                    </div>
                </div>
                
                <!-- Tabela de Jogadores -->
                <div class="table-container">
                    <% if (players && players.length > 0) { %>
                        <table id="playersTable">
                            <thead>
                                <tr>
                                    <th style="width: 30px;">
                                        <input type="checkbox" id="selectAllPlayers">
                                    </th>
                                    <th>Jogador</th>
                                    <th>Contacto</th>
                                    <th>Saldo</th>
                                    <th>Status</th>
                                    <th>√öltimo Login</th>
                                    <th>Registado</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% players.forEach((player, index) => { %>
                                    <tr data-player-id="<%= player._id || player.id %>">
                                        <td>
                                            <input type="checkbox" class="player-checkbox" value="<%= player._id || player.id %>">
                                        </td>
                                        <td>
                                            <div class="player-info-row">
                                                <div class="player-avatar">
                                                    <%= player.name ? player.name.charAt(0).toUpperCase() : 'U' %>
                                                </div>
                                                <div>
                                                    <div class="player-name"><%= player.name || 'Sem nome' %></div>
                                                    <div class="player-username">@<%= player.username || 'semusername' %></div>
                                                    <% if (player.country) { %>
                                                        <div class="player-country" style="font-size: 11px; color: var(--text-tertiary);">
                                                            <i class="fas fa-globe"></i> <%= player.country %>
                                                        </div>
                                                    <% } %>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="player-email"><%= player.email || 'Sem email' %></div>
                                            <% if (player.phone) { %>
                                                <div class="player-phone" style="font-size: 12px; color: var(--text-tertiary);">
                                                    <i class="fas fa-phone"></i> <%= player.phone %>
                                                </div>
                                            <% } %>
                                        </td>
                                        <td>
                                            <strong class="player-balance">‚Ç¨<%= player.balance ? player.balance.toFixed(2) : '0.00' %></strong>
                                            <% if (player.bonusBalance && player.bonusBalance > 0) { %>
                                                <div class="player-bonus" style="color: var(--warning); font-size: 12px;">
                                                    +‚Ç¨<%= player.bonusBalance.toFixed(2) %> b√≥nus
                                                </div>
                                            <% } %>
                                            <% if (player.totalWagered) { %>
                                                <div style="font-size: 11px; color: var(--text-tertiary);">
                                                    Apostado: ‚Ç¨<%= player.totalWagered.toFixed(2) %>
                                                </div>
                                            <% } %>
                                        </td>
                                        <td>
                                            <% 
                                                let statusClass = 'offline';
                                                let statusText = 'Offline';
                                                
                                                if (player.status === 'online') {
                                                    statusClass = 'online';
                                                    statusText = 'Online';
                                                } else if (player.status === 'active') {
                                                    statusClass = 'active';
                                                    statusText = 'Ativo';
                                                } else if (player.status === 'inactive') {
                                                    statusClass = 'inactive';
                                                    statusText = 'Inativo';
                                                } else if (player.status === 'banned') {
                                                    statusClass = 'banned';
                                                    statusText = 'Banido';
                                                }
                                            %>
                                            <span class="status-badge status-<%= statusClass %>"><%= statusText %></span>
                                            
                                            <div style="margin-top: 5px;">
                                                <% if (player.isVerified) { %>
                                                    <span class="status-badge status-active" style="font-size: 10px;">
                                                        <i class="fas fa-check-circle"></i> Verificado
                                                    </span>
                                                <% } else { %>
                                                    <span class="status-badge status-inactive" style="font-size: 10px;">
                                                        <i class="fas fa-clock"></i> Pendente
                                                    </span>
                                                <% } %>
                                            </div>
                                        </td>
                                        <td>
                                            <% if (player.lastLogin) { %>
                                                <span class="last-login-date"><%= new Date(player.lastLogin).toLocaleDateString('pt-PT') %></span>
                                                <div style="font-size: 12px; color: var(--text-tertiary);">
                                                    <span class="last-login-time"><%= new Date(player.lastLogin).toLocaleTimeString('pt-PT', {hour: '2-digit', minute:'2-digit'}) %></span>
                                                </div>
                                            <% } else { %>
                                                <span style="color: var(--text-tertiary);">Nunca</span>
                                            <% } %>
                                        </td>
                                        <td>
                                            <% if (player.createdAt) { %>
                                                <span class="registration-date"><%= new Date(player.createdAt).toLocaleDateString('pt-PT') %></span>
                                                <div style="font-size: 12px; color: var(--text-tertiary);">
                                                    h√° <span class="registration-days"><%= Math.floor((new Date() - new Date(player.createdAt)) / (1000 * 60 * 60 * 24)) %></span> dias
                                                </div>
                                            <% } else { %>
                                                <span style="color: var(--text-tertiary);">N/A</span>
                                            <% } %>
                                        </td>
                                        <td>
                                            <div class="player-actions">
                                                <button class="btn-icon view" data-action="view" data-player-id="<%= player._id || player.id %>" title="Ver detalhes">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn-icon edit" data-action="edit" data-player-id="<%= player._id || player.id %>" title="Editar jogador">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn-icon email" data-action="email" data-player-id="<%= player._id || player.id %>" data-email="<%= player.email %>" title="Enviar mensagem">
                                                    <i class="fas fa-envelope"></i>
                                                </button>
                                                <button class="btn-icon bonus" data-action="bonus" data-player-id="<%= player._id || player.id %>" title="Gerir b√≥nus">
                                                    <i class="fas fa-gift"></i>
                                                </button>
                                                <button class="btn-icon transaction" data-action="transaction" data-player-id="<%= player._id || player.id %>" title="Ver transa√ß√µes">
                                                    <i class="fas fa-exchange-alt"></i>
                                                </button>
                                                <% if (player.status === 'active' || player.status === 'online') { %>
                                                    <button class="btn-icon delete" data-action="deactivate" data-player-id="<%= player._id || player.id %>" title="Desativar jogador">
                                                        <i class="fas fa-ban"></i>
                                                    </button>
                                                <% } else { %>
                                                    <button class="btn-icon" data-action="activate" data-player-id="<%= player._id || player.id %>" title="Ativar jogador">
                                                        <i class="fas fa-check"></i>
                                                    </button>
                                                <% } %>
                                                <% if (player.status === 'banned') { %>
                                                    <button class="btn-icon" data-action="unban" data-player-id="<%= player._id || player.id %>" title="Remover ban">
                                                        <i class="fas fa-user-check"></i>
                                                    </button>
                                                <% } else { %>
                                                    <button class="btn-icon delete" data-action="ban" data-player-id="<%= player._id || player.id %>" title="Banir jogador">
                                                        <i class="fas fa-user-slash"></i>
                                                    </button>
                                                <% } %>
                                            </div>
                                        </td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>
                        
                        <!-- Pagina√ß√£o -->
                        <% if (totalPages > 1) { %>
                            <div class="pagination">
                                <% if (page > 1) { %>
                                    <a href="?page=<%= page-1 %>&search=<%= search || '' %>&status=<%= status || '' %>&sort=<%= sort || '' %>" class="page-link">
                                        <i class="fas fa-chevron-left"></i>
                                    </a>
                                <% } %>
                                
                                <% for (let i = 1; i <= totalPages; i++) { %>
                                    <% if (i === 1 || i === totalPages || (i >= page-2 && i <= page+2)) { %>
                                        <a href="?page=<%= i %>&search=<%= search || '' %>&status=<%= status || '' %>&sort=<%= sort || '' %>" 
                                           class="page-link <%= i === page ? 'active' : '' %>">
                                            <%= i %>
                                        </a>
                                    <% } else if (i === page-3 || i === page+3) { %>
                                        <span class="page-link">...</span>
                                    <% } %>
                                <% } %>
                                
                                <% if (page < totalPages) { %>
                                    <a href="?page=<%= page+1 %>&search=<%= search || '' %>&status=<%= status || '' %>&sort=<%= sort || '' %>" class="page-link">
                                        <i class="fas fa-chevron-right"></i>
                                    </a>
                                <% } %>
                            </div>
                        <% } %>
                        
                        <!-- Informa√ß√£o de sele√ß√£o -->
                        <div style="padding: 15px; background-color: var(--bg-tertiary); border-top: 1px solid var(--border-color);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div id="selectedCount" style="color: var(--text-secondary);">
                                    0 jogadores selecionados
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn btn-warning btn-sm" onclick="showBulkEditModal()" disabled id="bulkEditBtn">
                                        <i class="fas fa-edit"></i> Editar Selecionados
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="showBulkDeleteModal()" disabled id="bulkDeleteBtn">
                                        <i class="fas fa-trash"></i> Eliminar Selecionados
                                    </button>
                                </div>
                            </div>
                        </div>
                    <% } else { %>
                        <div class="empty-state">
                            <i class="fas fa-user-friends"></i>
                            <p>Nenhum jogador encontrado</p>
                            <button class="btn btn-primary" onclick="showAddPlayerModal()" style="margin-top: 20px;">
                                <i class="fas fa-plus"></i> Adicionar Primeiro Jogador
                            </button>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
        
        <!-- Overlay para mobile -->
        <div class="overlay" id="overlay"></div>
    </div>

    <!-- Modal de Detalhes do Jogador -->
    <div class="modal" id="playerDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user"></i> Detalhes do Jogador</h3>
                <button class="modal-close" onclick="closeModal('playerDetailsModal')">&times;</button>
            </div>
            <div class="modal-body" id="playerDetailsContent">
                <!-- Conte√∫do ser√° carregado dinamicamente -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('playerDetailsModal')">
                    <i class="fas fa-times"></i> Fechar
                </button>
                <button class="btn btn-primary" onclick="editCurrentPlayer()">
                    <i class="fas fa-edit"></i> Editar Jogador
                </button>
                <button class="btn btn-danger" onclick="deleteCurrentPlayer()">
                    <i class="fas fa-trash"></i> Eliminar Jogador
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Adicionar Jogador -->
    <div class="modal" id="addPlayerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Novo Jogador</h3>
                <button class="modal-close" onclick="closeModal('addPlayerModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addPlayerForm">
                    <div class="form-group">
                        <label class="form-label">Nome Completo *</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Username *</label>
                        <input type="text" class="form-control" name="username" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Senha *</label>
                        <input type="password" class="form-control" name="password" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirmar Senha *</label>
                        <input type="password" class="form-control" name="confirmPassword" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Telefone</label>
                        <input type="tel" class="form-control" name="phone">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Saldo Inicial (‚Ç¨)</label>
                        <input type="number" class="form-control" name="balance" step="0.01" value="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-control" name="status">
                            <option value="active">Ativo</option>
                            <option value="inactive">Inativo</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addPlayerModal')">Cancelar</button>
                <button class="btn btn-success" onclick="saveNewPlayer()">
                    <i class="fas fa-save"></i> Criar Jogador
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de A√ß√µes em Massa -->
    <div class="modal" id="bulkActionsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-tasks"></i> A√ß√µes em Massa</h3>
                <button class="modal-close" onclick="closeModal('bulkActionsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p id="selectedPlayersCount" style="margin-bottom: 20px;"></p>
                <div class="form-group">
                    <label class="form-label">Selecione uma a√ß√£o:</label>
                    <select class="form-control" id="bulkActionSelect">
                        <option value="">Selecione uma a√ß√£o...</option>
                        <option value="activate">Ativar jogadores</option>
                        <option value="deactivate">Desativar jogadores</option>
                        <option value="add_bonus">Adicionar b√≥nus</option>
                        <option value="delete">Eliminar jogadores</option>
                    </select>
                </div>
                <div id="bulkActionContent"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('bulkActionsModal')">Cancelar</button>
                <button class="btn btn-primary" id="executeBulkActionBtn" onclick="executeBulkAction()" disabled>
                    <i class="fas fa-play"></i> Executar A√ß√£o
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de B√≥nus -->
    <div class="modal" id="addBonusModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-gift"></i> Adicionar B√≥nus</h3>
                <button class="modal-close" onclick="closeModal('addBonusModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addBonusForm">
                    <input type="hidden" id="bonusPlayerId" name="playerId">
                    <div class="form-group">
                        <label class="form-label">Jogador</label>
                        <input type="text" class="form-control" id="bonusPlayerName" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor (‚Ç¨) *</label>
                        <input type="number" class="form-control" name="amount" step="0.01" min="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo de B√≥nus</label>
                        <select class="form-control" name="type">
                            <option value="welcome">B√≥nus de Boas-vindas</option>
                            <option value="deposit">B√≥nus de Dep√≥sito</option>
                            <option value="loyalty">B√≥nus de Fidelidade</option>
                            <option value="promotion">B√≥nus Promocional</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descri√ß√£o</label>
                        <textarea class="form-control" name="description" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addBonusModal')">Cancelar</button>
                <button class="btn btn-success" onclick="saveBonus()">
                    <i class="fas fa-gift"></i> Adicionar B√≥nus
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== VARI√ÅVEIS GLOBAIS =====
        let currentPlayerId = null;
        let selectedPlayers = new Set();
        
        // ===== FUN√á√ïES DE UTILIDADE =====
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                  type === 'error' ? 'exclamation-circle' : 
                                  type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 5000);
        }
        
        // ===== MANIPULA√á√ÉO DE MODAIS =====
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        
        // ===== SISTEMA DE NOTIFICA√á√ïES =====
        function setupNotifications() {
            const notificationBtn = document.getElementById('notificationBtn');
            const notificationsModal = document.getElementById('notificationsModal');
            const modalClose = document.getElementById('modalClose');
            const markAllAsReadBtn = document.getElementById('markAllAsReadBtn');
            const clearAllNotificationsBtn = document.getElementById('clearAllNotificationsBtn');
            
            // Abrir modal de notifica√ß√µes
            if (notificationBtn && notificationsModal) {
                notificationBtn.addEventListener('click', function() {
                    notificationsModal.style.display = 'flex';
                    notificationsModal.classList.add('active');
                    loadNotifications();
                });
            }
            
            // Fechar modal
            if (modalClose) {
                modalClose.addEventListener('click', function() {
                    notificationsModal.classList.remove('active');
                });
            }
            
            // Fechar modal ao clicar fora
            if (notificationsModal) {
                notificationsModal.addEventListener('click', function(e) {
                    if (e.target === notificationsModal) {
                        notificationsModal.classList.remove('active');
                    }
                });
            }
            
            // Marcar todas como lidas
            if (markAllAsReadBtn) {
                markAllAsReadBtn.addEventListener('click', markAllAsRead);
            }
            
            // Limpar todas as notifica√ß√µes
            if (clearAllNotificationsBtn) {
                clearAllNotificationsBtn.addEventListener('click', clearAllNotifications);
            }
            
            // Carregar notifica√ß√µes periodicamente
            loadNotifications();
            setInterval(loadNotifications, 60000); // Atualizar a cada 1 minuto
        }
        
        function loadNotifications() {
            fetch('/api/notifications')
                .then(response => {
                    if (!response.ok) throw new Error('Erro ao carregar notifica√ß√µes');
                    return response.json();
                })
                .then(data => {
                    updateNotificationCount(data.unreadCount || 0);
                    renderNotifications(data.notifications || []);
                })
                .catch(error => {
                    console.error('Erro ao carregar notifica√ß√µes:', error);
                    renderMockNotifications();
                });
        }
        
        function updateNotificationCount(count) {
            const notificationCount = document.getElementById('notificationCount');
            if (notificationCount) {
                if (count > 0) {
                    notificationCount.textContent = count > 99 ? '99+' : count;
                    notificationCount.classList.add('show');
                } else {
                    notificationCount.classList.remove('show');
                }
            }
        }
        
        function renderNotifications(notifications) {
            const notificationsList = document.getElementById('notificationsList');
            if (!notificationsList) return;
            
            if (notifications.length === 0) {
                notificationsList.innerHTML = `
                    <div class="empty-notifications">
                        <i class="fas fa-bell-slash"></i>
                        <p>Sem notifica√ß√µes no momento</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            notifications.forEach(notification => {
                const timeAgo = getTimeAgo(notification.createdAt);
                const iconClass = getNotificationIconClass(notification.type);
                const unreadClass = notification.read ? '' : 'unread';
                
                html += `
                    <div class="notification-item ${unreadClass}" data-id="${notification._id}">
                        <div class="notification-icon ${iconClass}">
                            <i class="${getNotificationIcon(notification.type)}"></i>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-message">${notification.message}</div>
                            <div class="notification-time">${timeAgo}</div>
                        </div>
                        ${!notification.read ? `
                            <div class="notification-actions">
                                <button class="notification-mark-read" title="Marcar como lida">
                                    <i class="fas fa-check"></i>
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            notificationsList.innerHTML = html;
            
            // Adicionar eventos para marcar como lida
            document.querySelectorAll('.notification-mark-read').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const notificationId = this.closest('.notification-item').dataset.id;
                    markAsRead(notificationId);
                });
            });
            
            // Adicionar evento para abrir notifica√ß√£o
            document.querySelectorAll('.notification-item').forEach(item => {
                item.addEventListener('click', function() {
                    const notificationId = this.dataset.id;
                    openNotification(notificationId);
                });
            });
        }
        
        function renderMockNotifications() {
            const mockNotifications = [
                {
                    _id: '1',
                    title: 'Novo Jogador Registado',
                    message: 'Um novo jogador registou-se no sistema.',
                    type: 'info',
                    read: false,
                    createdAt: new Date(Date.now() - 300000).toISOString()
                },
                {
                    _id: '2',
                    title: 'Dep√≥sito Realizado',
                    message: 'Jogador depositou ‚Ç¨100 na sua conta.',
                    type: 'success',
                    read: true,
                    createdAt: new Date(Date.now() - 3600000).toISOString()
                },
                {
                    _id: '3',
                    title: 'Levantamento Solicitado',
                    message: 'Novo pedido de levantamento pendente.',
                    type: 'warning',
                    read: false,
                    createdAt: new Date(Date.now() - 7200000).toISOString()
                }
            ];
            
            const unreadCount = mockNotifications.filter(n => !n.read).length;
            updateNotificationCount(unreadCount);
            renderNotifications(mockNotifications);
        }
        
        function markAsRead(notificationId) {
            fetch(`/api/notifications/${notificationId}/read`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => {
                if (response.ok) {
                    loadNotifications(); // Recarregar notifica√ß√µes
                }
            })
            .catch(error => {
                console.error('Erro ao marcar notifica√ß√£o como lida:', error);
            });
        }
        
        function markAllAsRead() {
            fetch('/api/notifications/read-all', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    showToast('Todas as notifica√ß√µes marcadas como lidas', 'success');
                    loadNotifications();
                } else {
                    showToast('Erro ao marcar notifica√ß√µes como lidas', 'error');
                }
            })
            .catch(error => {
                console.error('Erro ao marcar todas como lidas:', error);
                showToast('Erro ao comunicar com o servidor', 'error');
            });
        }
        
        function clearAllNotifications() {
            if (confirm('Tem certeza que deseja limpar todas as notifica√ß√µes? As notifica√ß√µes lidas e com mais de 30 dias ser√£o permanentemente eliminadas.')) {
                fetch('/api/notifications/clear-all', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ confirm: 'true' })
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        showToast(result.message, 'success');
                        loadNotifications();
                    } else {
                        showToast(result.error || 'Erro ao limpar notifica√ß√µes', 'error');
                    }
                })
                .catch(error => {
                    console.error('Erro ao limpar notifica√ß√µes:', error);
                    showToast('Erro ao comunicar com o servidor', 'error');
                });
            }
        }
        
        function openNotification(notificationId) {
            console.log('Abrir notifica√ß√£o:', notificationId);
            markAsRead(notificationId);
        }
        
        function getNotificationIcon(type) {
            switch(type) {
                case 'warning': return 'fas fa-exclamation-triangle';
                case 'success': return 'fas fa-check-circle';
                case 'danger': return 'fas fa-exclamation-circle';
                case 'info': 
                default: return 'fas fa-info-circle';
            }
        }
        
        function getNotificationIconClass(type) {
            switch(type) {
                case 'warning': return 'warning';
                case 'success': return 'success';
                case 'danger': return 'danger';
                case 'info': 
                default: return 'info';
            }
        }
        
        function getTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Agora mesmo';
            if (diffMins < 60) return `H√° ${diffMins} min`;
            if (diffHours < 24) return `H√° ${diffHours} h`;
            if (diffDays < 7) return `H√° ${diffDays} d`;
            return date.toLocaleDateString('pt-PT');
        }
        
        // ===== FUN√á√ïES DE JOGADORES =====
        function viewPlayerDetails(playerId) {
            currentPlayerId = playerId;
            const playerRow = document.querySelector(`tr[data-player-id="${playerId}"]`);
            
            if (!playerRow) {
                showToast('Jogador n√£o encontrado', 'error');
                return;
            }
            
            const playerName = playerRow.querySelector('.player-name').textContent;
            const playerUsername = playerRow.querySelector('.player-username').textContent;
            const playerEmail = playerRow.querySelector('.player-email').textContent;
            const playerPhone = playerRow.querySelector('.player-phone')?.textContent || 'N√£o informado';
            const playerBalance = playerRow.querySelector('.player-balance').textContent;
            const playerStatus = playerRow.querySelector('.status-badge').textContent;
            const lastLoginDate = playerRow.querySelector('.last-login-date')?.textContent || 'Nunca';
            const lastLoginTime = playerRow.querySelector('.last-login-time')?.textContent || '';
            const registrationDate = playerRow.querySelector('.registration-date')?.textContent || 'N/A';
            const registrationDays = playerRow.querySelector('.registration-days')?.textContent || '0';
            
            const content = `
                <div class="player-details-grid">
                    <div class="player-detail-card">
                        <h4>Informa√ß√µes B√°sicas</h4>
                        <p><strong>Nome:</strong> ${playerName}</p>
                        <p><strong>Username:</strong> ${playerUsername}</p>
                        <p><strong>Status:</strong> <span class="status-badge status-active">${playerStatus}</span></p>
                        <p><strong>Registado h√°:</strong> ${registrationDays} dias</p>
                    </div>
                    <div class="player-detail-card">
                        <h4>Informa√ß√µes de Contacto</h4>
                        <p><strong>Email:</strong> ${playerEmail}</p>
                        <p><strong>Telefone:</strong> ${playerPhone}</p>
                        <p><strong>√öltimo Login:</strong> ${lastLoginDate} ${lastLoginTime ? '√†s ' + lastLoginTime : ''}</p>
                        <p><strong>Data de Registo:</strong> ${registrationDate}</p>
                    </div>
                    <div class="player-detail-card">
                        <h4>Informa√ß√µes Financeiras</h4>
                        <p><strong>Saldo Atual:</strong> ${playerBalance}</p>
                        <p><strong>Total Depositado:</strong> ‚Ç¨0.00</p>
                        <p><strong>Total Levantado:</strong> ‚Ç¨0.00</p>
                        <p><strong>Total Apostado:</strong> ‚Ç¨0.00</p>
                    </div>
                    <div class="player-detail-card">
                        <h4>Estat√≠sticas</h4>
                        <p><strong>Jogos Jogados:</strong> 0</p>
                        <p><strong>Vit√≥rias:</strong> 0</p>
                        <p><strong>Derrotas:</strong> 0</p>
                        <p><strong>Tempo de Jogo:</strong> 0 horas</p>
                    </div>
                </div>
            `;
            
            document.getElementById('playerDetailsContent').innerHTML = content;
            openModal('playerDetailsModal');
        }
        
        function editPlayer(playerId) {
            showToast('Redirecionando para p√°gina de edi√ß√£o...', 'info');
            setTimeout(() => {
                window.location.href = `/players/edit/${playerId}`;
            }, 1000);
        }
        
        function editCurrentPlayer() {
            if (currentPlayerId) {
                editPlayer(currentPlayerId);
            } else {
                showToast('Nenhum jogador selecionado', 'warning');
            }
        }
        
        function deleteCurrentPlayer() {
            if (!currentPlayerId) {
                showToast('Nenhum jogador selecionado', 'warning');
                return;
            }
            
            if (confirm('Tem certeza que deseja eliminar este jogador? Esta a√ß√£o n√£o pode ser desfeita.')) {
                showToast('Jogador eliminado com sucesso!', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            }
        }
        
        function sendMessageToPlayer(playerId, email) {
            const message = prompt(`Digite a mensagem para enviar para ${email}:`);
            if (message) {
                showToast(`Mensagem enviada para ${email}`, 'success');
                // Aqui iria o c√≥digo para enviar a mensagem
            }
        }
        
        function managePlayerBonus(playerId) {
            currentPlayerId = playerId;
            const playerRow = document.querySelector(`tr[data-player-id="${playerId}"]`);
            
            if (playerRow) {
                const playerName = playerRow.querySelector('.player-name').textContent;
                document.getElementById('bonusPlayerId').value = playerId;
                document.getElementById('bonusPlayerName').value = playerName;
                openModal('addBonusModal');
            }
        }
        
        function saveBonus() {
            const amount = document.querySelector('#addBonusForm [name="amount"]').value;
            const type = document.querySelector('#addBonusForm [name="type"]').value;
            
            if (!amount || parseFloat(amount) <= 0) {
                showToast('Por favor, insira um valor v√°lido para o b√≥nus.', 'error');
                return;
            }
            
            showToast(`B√≥nus de ‚Ç¨${amount} (${type}) adicionado com sucesso!`, 'success');
            closeModal('addBonusModal');
        }
        
        function managePlayerTransactions(playerId) {
            showToast('Funcionalidade de transa√ß√µes em desenvolvimento', 'info');
        }
        
        function changePlayerStatus(playerId, newStatus) {
            const action = newStatus === 'active' ? 'ativar' : 'desativar';
            
            if (confirm(`Tem certeza que deseja ${action} este jogador?`)) {
                showToast(`Jogador ${action} com sucesso!`, 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }
        }
        
        function banPlayer(playerId) {
            if (confirm('Tem certeza que deseja banir este jogador?')) {
                showToast('Jogador banido com sucesso!', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }
        }
        
        // ===== MANIPULA√á√ÉO DE EVENTOS =====
        function handlePlayerAction(event) {
            const button = event.target.closest('button[data-action]');
            if (!button) return;
            
            event.preventDefault();
            event.stopPropagation();
            
            const action = button.getAttribute('data-action');
            const playerId = button.getAttribute('data-player-id');
            const email = button.getAttribute('data-email');
            
            if (!playerId) return;
            
            currentPlayerId = playerId;
            
            switch(action) {
                case 'view':
                    viewPlayerDetails(playerId);
                    break;
                case 'edit':
                    editPlayer(playerId);
                    break;
                case 'email':
                    sendMessageToPlayer(playerId, email);
                    break;
                case 'bonus':
                    managePlayerBonus(playerId);
                    break;
                case 'transaction':
                    managePlayerTransactions(playerId);
                    break;
                case 'activate':
                    changePlayerStatus(playerId, 'active');
                    break;
                case 'deactivate':
                    changePlayerStatus(playerId, 'inactive');
                    break;
                case 'ban':
                    banPlayer(playerId);
                    break;
                case 'unban':
                    changePlayerStatus(playerId, 'active');
                    break;
                default:
                    console.warn('A√ß√£o desconhecida:', action);
            }
        }
        
        // ===== SELE√á√ÉO DE JOGADORES =====
        function toggleSelectAllPlayers() {
            const selectAll = document.getElementById('selectAllPlayers');
            const checkboxes = document.querySelectorAll('.player-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
                if (selectAll.checked) {
                    selectedPlayers.add(checkbox.value);
                } else {
                    selectedPlayers.delete(checkbox.value);
                }
            });
            
            updateSelectedCount();
        }
        
        function updateSelectedCount() {
            const count = selectedPlayers.size;
            const countElement = document.getElementById('selectedCount');
            const bulkEditBtn = document.getElementById('bulkEditBtn');
            const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');
            
            if (countElement) {
                countElement.textContent = `${count} jogador(es) selecionado(s)`;
            }
            
            if (bulkEditBtn) bulkEditBtn.disabled = count === 0;
            if (bulkDeleteBtn) bulkDeleteBtn.disabled = count === 0;
        }
        
        // ===== FUN√á√ïES DE MODAL =====
        function showAddPlayerModal() {
            openModal('addPlayerModal');
        }
        
        function showBulkActionsModal() {
            if (selectedPlayers.size === 0) {
                showToast('Selecione jogadores para a√ß√µes em massa', 'warning');
                return;
            }
            
            document.getElementById('selectedPlayersCount').textContent = 
                `${selectedPlayers.size} jogador(es) selecionado(s)`;
            openModal('bulkActionsModal');
        }
        
        function showBulkEditModal() {
            if (selectedPlayers.size === 0) {
                showToast('Selecione jogadores para editar', 'warning');
                return;
            }
            showToast('Funcionalidade de edi√ß√£o em massa em desenvolvimento', 'info');
        }
        
        function showBulkDeleteModal() {
            if (selectedPlayers.size === 0) {
                showToast('Selecione jogadores para eliminar', 'warning');
                return;
            }
            
            if (confirm(`Tem certeza que deseja eliminar ${selectedPlayers.size} jogador(es)?`)) {
                showToast('Jogadores eliminados com sucesso!', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            }
        }
        
        // ===== OUTRAS FUN√á√ïES =====
        function exportPlayersToCSV() {
            if (selectedPlayers.size === 0) {
                showToast('Selecione jogadores para exportar', 'warning');
                return;
            }
            
            showToast('Gerando ficheiro CSV...', 'info');
            
            // Simula√ß√£o de exporta√ß√£o
            setTimeout(() => {
                showToast('CSV gerado com sucesso!', 'success');
            }, 1500);
        }
        
        function saveNewPlayer() {
            const form = document.getElementById('addPlayerForm');
            const formData = new FormData(form);
            
            // Valida√ß√£o simples
            const password = formData.get('password');
            const confirmPassword = formData.get('confirmPassword');
            
            if (!formData.get('name') || !formData.get('email') || !formData.get('username') || !password || !confirmPassword) {
                showToast('Por favor, preencha todos os campos obrigat√≥rios.', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showToast('As senhas n√£o coincidem.', 'error');
                return;
            }
            
            showToast('Jogador criado com sucesso!', 'success');
            closeModal('addPlayerModal');
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        }
        
        function executeBulkAction() {
            const action = document.getElementById('bulkActionSelect').value;
            
            if (!action) {
                showToast('Por favor, selecione uma a√ß√£o.', 'error');
                return;
            }
            
            if (action === 'delete') {
                const confirmText = document.getElementById('bulkDeleteConfirm')?.value;
                if (confirmText !== 'ELIMINAR') {
                    showToast('Por favor, digite "ELIMINAR" para confirmar.', 'error');
                    return;
                }
            }
            
            const actionNames = {
                'activate': 'ativados',
                'deactivate': 'desativados',
                'add_bonus': 'receberam b√≥nus',
                'delete': 'eliminados'
            };
            
            showToast(`${selectedPlayers.size} jogador(es) ${actionNames[action]} com sucesso!`, 'success');
            closeModal('bulkActionsModal');
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        }
        
        // ===== TEMA E MENU =====
        function initTheme() {
            const savedTheme = localStorage.getItem('b7uno-theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            document.querySelectorAll('.theme-toggle').forEach(toggle => {
                toggle.setAttribute('data-theme', savedTheme);
            });
            
            // Atualizar labels
            document.querySelectorAll('.theme-label').forEach(label => {
                label.textContent = savedTheme === 'light' ? 'Modo Claro' : 'Modo Escuro';
            });
        }
        
        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = current === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('b7uno-theme', newTheme);
            
            document.querySelectorAll('.theme-toggle').forEach(toggle => {
                toggle.setAttribute('data-theme', newTheme);
            });
            
            document.querySelectorAll('.theme-label').forEach(label => {
                label.textContent = newTheme === 'light' ? 'Modo Claro' : 'Modo Escuro';
            });
        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            
            if (window.innerWidth <= 1024) {
                sidebar.classList.toggle('active');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
            }
        }
        
        // ===== USER DROPDOWN =====
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            if (dropdown.style.display === 'block') {
                dropdown.style.display = 'none';
            } else {
                dropdown.style.display = 'block';
            }
        }
        
        // ===== REL√ìGIO =====
        function startClock() {
            function updateTime() {
                const now = new Date();
                const timeElement = document.getElementById('serverTime');
                if (timeElement) {
                    timeElement.textContent = now.toLocaleTimeString('pt-PT');
                }
            }
            
            updateTime();
            setInterval(updateTime, 1000);
        }
        
        // ===== INICIALIZA√á√ÉO =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üé∞ Jogadores B7Uno Carregado');
            
            // Inicializar tema
            initTheme();
            
            // Inicializar sistema de notifica√ß√µes
            setupNotifications();
            
            // Inicializar rel√≥gio
            startClock();
            
            // Eventos do tema
            document.querySelectorAll('.theme-toggle').forEach(toggle => {
                toggle.addEventListener('click', toggleTheme);
            });
            
            // Evento do menu toggle
            const menuToggle = document.getElementById('menuToggle');
            if (menuToggle) {
                menuToggle.addEventListener('click', toggleSidebar);
            }
            
            // Evento do overlay
            const overlay = document.getElementById('overlay');
            if (overlay) {
                overlay.addEventListener('click', () => {
                    const sidebar = document.getElementById('sidebar');
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                });
            }
            
            // Eventos do user dropdown
            const userProfile = document.getElementById('userProfile');
            if (userProfile) {
                userProfile.addEventListener('click', toggleUserDropdown);
            }
            
            // Fechar dropdown ao clicar fora
            document.addEventListener('click', function(event) {
                const dropdown = document.getElementById('userDropdown');
                const userProfile = document.getElementById('userProfile');
                
                if (dropdown && userProfile && 
                    !dropdown.contains(event.target) && 
                    !userProfile.contains(event.target)) {
                    dropdown.style.display = 'none';
                }
            });
            
            // Fechar modais ao clicar fora ou com ESC
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal(this.id);
                    }
                });
            });
            
            // Fechar com ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal.active').forEach(modal => {
                        closeModal(modal.id);
                    });
                }
            });
            
            // Eventos de logout
            document.querySelectorAll('#logoutBtnSidebar, #logoutBtnDropdown').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (confirm('Deseja sair do sistema?')) {
                        window.location.href = '/logout';
                    }
                });
            });
            
            // Eventos dos checkboxes
            const selectAllCheckbox = document.getElementById('selectAllPlayers');
            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', toggleSelectAllPlayers);
            }
            
            // Eventos dos checkboxes individuais
            document.querySelectorAll('.player-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        selectedPlayers.add(this.value);
                    } else {
                        selectedPlayers.delete(this.value);
                        document.getElementById('selectAllPlayers').checked = false;
                    }
                    updateSelectedCount();
                });
            });
            
            // Eventos dos bot√µes de a√ß√£o (event delegation)
            const playersTable = document.getElementById('playersTable');
            if (playersTable) {
                playersTable.addEventListener('click', handlePlayerAction);
            }
            
            // Evento do dropdown de a√ß√µes em massa
            const bulkActionSelect = document.getElementById('bulkActionSelect');
            if (bulkActionSelect) {
                bulkActionSelect.addEventListener('change', function() {
                    const action = this.value;
                    const contentDiv = document.getElementById('bulkActionContent');
                    const executeBtn = document.getElementById('executeBulkActionBtn');
                    
                    if (executeBtn) {
                        executeBtn.disabled = !action;
                    }
                    
                    let content = '';
                    
                    switch(action) {
                        case 'activate':
                            content = `
                                <div style="background-color: rgba(40, 167, 69, 0.1); color: var(--success); padding: 15px; border-radius: 8px; margin-top: 10px; border: 1px solid rgba(40, 167, 69, 0.3);">
                                    <i class="fas fa-check-circle"></i> Esta a√ß√£o ativar√° ${selectedPlayers.size} jogador(es).
                                </div>
                            `;
                            break;
                            
                        case 'deactivate':
                            content = `
                                <div style="background-color: rgba(255, 193, 7, 0.1); color: var(--warning); padding: 15px; border-radius: 8px; margin-top: 10px; border: 1px solid rgba(255, 193, 7, 0.3);">
                                    <i class="fas fa-exclamation-triangle"></i> Esta a√ß√£o desativar√° ${selectedPlayers.size} jogador(es).
                                </div>
                            `;
                            break;
                            
                        case 'add_bonus':
                            content = `
                                <div style="background-color: rgba(23, 162, 184, 0.1); color: var(--info); padding: 15px; border-radius: 8px; margin-top: 10px; border: 1px solid rgba(23, 162, 184, 0.3);">
                                    <i class="fas fa-gift"></i> Adicionar b√≥nus a ${selectedPlayers.size} jogador(es).
                                </div>
                                <div class="form-group" style="margin-top: 15px;">
                                    <label class="form-label">Valor (‚Ç¨) *</label>
                                    <input type="number" class="form-control" id="bulkBonusAmount" value="10.00" step="0.01" min="0.01">
                                </div>
                            `;
                            break;
                            
                        case 'delete':
                            content = `
                                <div style="background-color: rgba(220, 53, 69, 0.1); color: var(--danger); padding: 15px; border-radius: 8px; margin-top: 10px; border: 1px solid rgba(220, 53, 69, 0.3);">
                                    <i class="fas fa-exclamation-triangle"></i> <strong>ATEN√á√ÉO:</strong> Esta a√ß√£o eliminar√° permanentemente ${selectedPlayers.size} jogador(es).
                                </div>
                                <div class="form-group" style="margin-top: 15px;">
                                    <label class="form-label">Confirmar elimina√ß√£o</label>
                                    <input type="text" class="form-control" id="bulkDeleteConfirm" placeholder="Digite 'ELIMINAR' para confirmar...">
                                </div>
                            `;
                            break;
                    }
                    
                    if (contentDiv) {
                        contentDiv.innerHTML = content;
                    }
                });
            }
        });
    </script>
</body>
</html>